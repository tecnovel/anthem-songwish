module.exports=[406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},9173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},2911,e=>{"use strict";var t=e.i(9173);let r=global.__prisma??new t.PrismaClient;e.s(["default",0,r])},4054,e=>{"use strict";var t=e.i(6747),r=e.i(9245),a=e.i(4898),i=e.i(2950),n=e.i(2911);function s(e){return e.map(e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes("\n")||t.includes('"')?`"${t.replace(/"/g,'""')}"`:t}).join(",")}async function o(e,t){if("GET"!==e.method){t.setHeader("Allow","GET"),t.status(405).json({error:"Method not allowed"});return}let r="false"!==((Array.isArray(e.query.grouped)?e.query.grouped[0]:e.query.grouped)??"true").toString().toLowerCase(),a=Array.isArray(e.query.q)?e.query.q[0]:e.query.q;try{let e=function(e){if(!e)return{};let t=e.trim();return t?{OR:[{trackName:{contains:t,mode:"insensitive"}},{trackArtists:{contains:t,mode:"insensitive"}},{firstName:{contains:t,mode:"insensitive"}},{lastName:{contains:t,mode:"insensitive"}},{email:{contains:t,mode:"insensitive"}}]}:{}}("string"==typeof a?a:void 0),i=await n.default.songWish.findMany({where:e,orderBy:{createdAt:"desc"}}),o="";if(r){let e=new Map;for(let t of i){let r=e.get(t.trackId),a=`${t.firstName} ${t.lastName}`.trim();if(r)r.count+=1,a&&r.names.add(a);else{let r=new Set;a&&r.add(a),e.set(t.trackId,{count:1,trackName:t.trackName,trackArtists:t.trackArtists,album:t.album,spotifyUrl:t.spotifyUrl,names:r})}}let t=Array.from(e.entries()).map(([e,t])=>({trackId:e,...t})).sort((e,t)=>t.count!==e.count?t.count-e.count:e.trackName.localeCompare(t.trackName));o+=s(["rank","votes","trackName","trackArtists","album","spotifyUrl","names"]),o+="\n",t.forEach((e,t)=>{let r=e.names?Array.from(e.names).join("; "):"";o+=s([t+1,e.count,e.trackName,e.trackArtists,e.album??"",e.spotifyUrl??"",r]),o+="\n"})}else o+=s(["createdAt","firstName","lastName","email","trackName","trackArtists","album","spotifyUrl","slotIndex","channel"]),o+="\n",i.forEach(e=>{o+=s([e.createdAt.toISOString(),e.firstName,e.lastName,e.email,e.trackName,e.trackArtists,e.album??"",e.spotifyUrl??"",e.slotIndex,e.channel??""]),o+="\n"});t.setHeader("Content-Type","text/csv; charset=utf-8"),t.setHeader("Content-Disposition",`attachment; filename="songwishes_${r?"grouped":"raw"}.csv"`),t.status(200).send(o)}catch(e){console.error("Error in /api/admin/export:",e),t.status(500).json({error:"Internal server error"})}}e.s(["default",()=>o],5351);var l=e.i(5351),d=e.i(7031),u=e.i(1927),c=e.i(6432);let p=(0,i.hoist)(l,"default"),m=(0,i.hoist)(l,"config"),f=new a.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/admin/export",pathname:"/api/admin/export",bundlePath:"",filename:""},userland:l,distDir:".next",relativeProjectDir:""});async function y(e,r,a){f.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/export";i=i.replace(/\/index$/,"")||"/";let n=await f.prepare(e,r,{srcPage:i});if(!n){r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:s,params:o,prerenderManifest:l,routerServerContext:p}=n;try{let t=e.method||"GET",a=(0,d.getTracer)(),n=a.getActiveScopeSpan(),c=f.instrumentationOnRequestError.bind(f),m=async n=>f.render(e,r,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:f.isDev,page:"/api/admin/export",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${t} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${t} ${i}`)});n?await m(n):await a.withPropagatedContext(e.headers,()=>a.trace(u.BaseServerSpan.handleRequest,{spanName:`${t} ${i}`,kind:d.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},m))}catch(e){if(f.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,m,"default",0,p,"handler",()=>y],4054)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b0f5d803._.js.map