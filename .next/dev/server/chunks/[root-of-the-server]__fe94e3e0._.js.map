{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/noahpique/Documents/AnthemTool/anthem-songwish/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\n// Prevent multiple instances of Prisma Client in development (hot-reloading)\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\nconst prisma = global.__prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") global.__prisma = prisma;\n\nexport default prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAOA,MAAM,SAAS,OAAO,QAAQ,IAAI,IAAI,6IAAY;AAElD,wCAA2C,OAAO,QAAQ,GAAG;uCAE9C","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///Users/noahpique/Documents/AnthemTool/anthem-songwish/src/pages/api/admin/song-wishes.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\nimport type { Prisma } from \"@prisma/client\";\n\nimport prisma from \"../../../lib/prisma\";\n\ntype GroupedItem = {\n  trackId: string;\n  trackName: string;\n  trackArtists: string;\n  album?: string | null;\n  imageUrl?: string | null;\n  spotifyUrl?: string | null;\n  durationMs?: number | null;\n  voteCount: number;\n};\n\ntype RawItem = {\n  id: string;\n  createdAt: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  trackId: string;\n  trackName: string;\n  trackArtists: string;\n  album?: string | null;\n  imageUrl?: string | null;\n  spotifyUrl?: string | null;\n  durationMs?: number | null;\n  slotIndex: number;\n  channel?: string | null;\n};\n\ntype GroupedResponse = {\n  grouped: true;\n  items: GroupedItem[];\n};\n\ntype RawResponse = {\n  grouped: false;\n  items: RawItem[];\n};\n\ntype ErrorResponse = {\n  error: string;\n};\n\nfunction buildWhereClause(query: string | undefined): Prisma.SongWishWhereInput {\n  if (!query) {\n    return {};\n  }\n\n  const trimmed = query.trim();\n  if (!trimmed) {\n    return {};\n  }\n\n  return {\n    OR: [\n      { trackName: { contains: trimmed, mode: \"insensitive\" as const } },\n      { trackArtists: { contains: trimmed, mode: \"insensitive\" as const } },\n      { firstName: { contains: trimmed, mode: \"insensitive\" as const } },\n      { lastName: { contains: trimmed, mode: \"insensitive\" as const } },\n      { email: { contains: trimmed, mode: \"insensitive\" as const } },\n    ],\n  };\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<GroupedResponse | RawResponse | ErrorResponse>,\n): Promise<void> {\n  if (req.method !== \"GET\") {\n    res.setHeader(\"Allow\", \"GET\");\n    res.status(405).json({ error: \"Method not allowed\" });\n    return;\n  }\n\n  const groupedValue = Array.isArray(req.query.grouped) ? req.query.grouped[0] : req.query.grouped;\n  const groupedParam = (groupedValue ?? \"true\").toString().toLowerCase();\n  const grouped = groupedParam !== \"false\";\n  const searchValue = Array.isArray(req.query.q) ? req.query.q[0] : req.query.q;\n  const searchQuery = typeof searchValue === \"string\" ? searchValue : undefined;\n\n  try {\n    const where = buildWhereClause(searchQuery);\n\n    const wishes = await prisma.songWish.findMany({\n      where,\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    if (grouped) {\n      const map = new Map<string, GroupedItem>();\n\n      for (const wish of wishes) {\n        const existing = map.get(wish.trackId);\n        if (existing) {\n          existing.voteCount += 1;\n        } else {\n          map.set(wish.trackId, {\n            trackId: wish.trackId,\n            trackName: wish.trackName,\n            trackArtists: wish.trackArtists,\n            album: wish.album,\n            imageUrl: wish.imageUrl,\n            spotifyUrl: wish.spotifyUrl,\n            durationMs: wish.durationMs,\n            voteCount: 1,\n          });\n        }\n      }\n\n      const items = Array.from(map.values()).sort((a, b) => {\n        if (b.voteCount !== a.voteCount) {\n          return b.voteCount - a.voteCount;\n        }\n        return a.trackName.localeCompare(b.trackName);\n      });\n\n      res.status(200).json({ grouped: true, items });\n      return;\n    }\n\n    const items: RawItem[] = wishes.map((wish) => ({\n      id: wish.id,\n      createdAt: wish.createdAt.toISOString(),\n      firstName: wish.firstName,\n      lastName: wish.lastName,\n      email: wish.email,\n      trackId: wish.trackId,\n      trackName: wish.trackName,\n      trackArtists: wish.trackArtists,\n      album: wish.album,\n      imageUrl: wish.imageUrl,\n      spotifyUrl: wish.spotifyUrl,\n      durationMs: wish.durationMs,\n      slotIndex: wish.slotIndex,\n      channel: wish.channel,\n    }));\n\n    res.status(200).json({ grouped: false, items });\n  } catch (error) {\n    console.error(\"Error in /api/admin/song-wishes:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}